---
name: sync-knowledge
description: skill-discovery 承認後に実行し、学びを kb-* へ反映する。既存KB追記、新規KB作成、振り分けテーブルに基づく整理に使う
user-invocable: true
---

# ナレッジベース更新

現在のプロジェクトで得た学びを `/root/.claude/skills/` 配下のナレッジスキルに反映してください。

## 振り分けテーブル

学びの内容に応じて、以下のテーブルで振り分け先を決定する。**迷った場合はテーブルを優先**し、感覚で振り分けない。

| トピック | 振り分け先 | 例 |
|---------|-----------|-----|
| React/Tailwind/UI/zustand/dnd-kit/モバイル対応 | `kb-frontend` | コンポーネントパターン、CSS Tips |
| SSE/API設計/外部API連携/サーバーサイドキャッシュ | `kb-api-patterns` | SSE処理、モック設計、Google Sheets連携 |
| Strands Agents/Bedrock AgentCore/Observability | `kb-strands-agentcore` | ツール定義、CDKデプロイ、OTELログ |
| Amplify Gen2/CDK/sandbox/本番デプロイ | `kb-amplify-cdk` | sandbox管理、Hotswap、環境分岐 |
| 問題→原因→解決の形式 | `kb-troubleshooting` | エラー解決、デバッグ手法 |
| AWSアーキテクチャ図 | `draw-architecture` | diagrams、カスタムアイコン |
| 上記のどれにも該当しない新領域 | **新規KB作成**（後述） | 新フレームワーク、新サービス |

### 振り分けの注意

- 1つの学びが複数KBに該当する場合: **実装パターンは該当KB**、**トラブルシューティングは `kb-troubleshooting`** に分けて記載し、相互参照を追加
- `kb-troubleshooting` には症状→原因→解決策の形式で書く。実装パターンの詳細は書かない（該当KBへの参照を記載）

## 実行手順

### ステップ1: プロジェクトの学びを確認

- プロジェクトの `/docs` 配下のドキュメント（KNOWLEDGE.md等）を確認
- 今回のセッションで解決した問題や得た知見を整理

### ステップ2: 振り分けテーブルで振り分け先を決定

- 上記テーブルに従って、各学びの振り分け先を決定
- **既存KBに該当しない場合はステップ5（新規KB作成）へ進む**

### ステップ3: 既存KBを更新

- `/root/.claude/skills/kb-*/SKILL.md` を読み込み
- 既存の内容と重複しないか確認
- プロジェクト固有でない汎用的な学びを追記
- コード例や具体的な解決策を含める

### ステップ4: 更新内容を報告

- どのスキルに何を追記したかをユーザーに報告
- 設定リポジトリへの同期が必要か確認

### ステップ5: 新規KB作成（該当KBがない場合のみ）

既存KBのどれにも該当しない、独立した新領域の知見が蓄積された場合に新規KBを作成する。

#### 作成判断基準

以下をすべて満たす場合のみ新規作成:

- 既存KBのどのスコープにも合わない
- 3件以上の知見がまとまっている（1件だけなら既存KBに仮置き）
- 別プロジェクトでも再利用可能

#### 新規KBテンプレート

```markdown
---
name: kb-<topic>
description: <ドメインの説明と利用シーン>
user-invocable: true
---

# <Topic> ナレッジ

## 基本パターン

### <パターン名>
- いつ使うか
- 手順

## トラブルシューティング

### <問題名>

**症状**: ...

**原因**: ...

**解決策**:
（コード例）
```

#### 新規KB作成後の必須作業

1. **このファイルの振り分けテーブルに新KBを追加する**
2. ユーザーに報告し、スコープが適切か確認

## 品質ルール

- プロジェクト固有の情報（APIキー、アカウントID、固有リソース名等）は含めない
- 既存の内容と重複しないよう確認
- 他のプロジェクトでも再利用できる汎用的な形式で記述
- コード例は実行可能な最小限のスニペットにする
- 陳腐化した情報は明示的に deprecated とマークするか削除する

## 次のステップ

KB更新後は、必要に応じて `sync-settings` でGitHub同期を検討してください。
