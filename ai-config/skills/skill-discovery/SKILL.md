---
name: skill-discovery
description: 作業完了時に再利用可能なパターンを自動検知し、既存スキルとの重複確認後に候補を1件だけ提案する。承認後のみナレッジ更新フローへ接続する。
user-invocable: true
---

# Skill Discovery

作業ログから「再利用価値のあるパターン」を検知し、スキル化候補として提案するためのスキルです。

## 目的

- 学びの検知を人間依存から減らす
- 既存の知識更新フロー（`sync-knowledge` / `kb-project-authoring`）へ安全に接続する
- 提案ノイズを抑える

## 実行タイミング

- 作業完了時（最終報告の直前）
- ユーザーが「スキル化できる学びがあるか」を確認したいとき

## ガードレール

1. 作業途中で割り込まない。候補提案は最後に行う。
2. 1セッション（`/clear` まで）で提案は最大1件。
3. 低信頼（根拠が弱い）なら提案しない。
4. ユーザー承認なしで `kb-*` を更新しない。
5. CLI固有のスラッシュコマンドに依存しない。

## 検知基準（高信頼の目安）

以下のうち2つ以上を満たす場合のみ候補化する:

- 同種の手順・修正を同一セッションで複数回実施した
- 問題の原因と解決手順が明確に再現可能
- プロジェクト固有ではなく、別PJでも再利用可能
- 手順化すると工数削減が見込める（調査・修正・検証の型がある）

補足:
- コンパクションで「同一セッション内の複数回実施」が判定しづらい場合は、他の基準を優先して判断する。

## 実行手順

1. **候補抽出**
   - 今回の作業から再利用可能なパターンを最大3件抽出
   - 各候補に「症状/原因/手順/検証」を1行ずつメモ

2. **重複チェック**
   - `{{SKILLS_DIR}}/kb-*/SKILL.md` を確認し、同等内容が既にないか確認
   - 同等内容がある候補は破棄

3. **候補の絞り込み**
   - 残った候補から最も価値が高い1件のみ選ぶ
   - 候補名は英小文字kebab-caseで命名

4. **提案（1行）**
   - 以下フォーマットで1行提案:
   - `[skill-candidate] <name> | target: <existing kb-*> or <new kb-*> | reason: <再利用根拠>`

5. **承認後の処理**
   - 既存 `kb-*` へ追記する場合:
     - `{{SKILLS_DIR}}/sync-knowledge/SKILL.md` の手順に従う
   - 新規 `kb-*` を作る場合:
     - `{{SKILLS_DIR}}/kb-project-authoring/SKILL.md` の手順に従う

6. **却下時の処理**
   - 却下された場合は何もしない
   - 同一セッション内では同じ候補を再提案しない
   - 永続的な却下履歴（`rejected.yml` 等）は現時点では扱わない（必要になった時点で導入）

## 提案しないケース

- 一回限りの運用作業
- 環境固有・アカウント固有の内容
- 既存 `kb-*` に同等の手順が明記済み

## 次のステップ

必要なら、以下を提案してください:

> 「今回の作業から再利用可能なスキル候補を1件提案できます。確認しますか？」
